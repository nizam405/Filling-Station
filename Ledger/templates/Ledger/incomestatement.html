{% extends 'base.html' %}
{% block title %}আয়-ব্যয় বিবরণী{% endblock title %}
{% block style %}
<style>
    @media print{
        #full-ledger a {
            text-decoration: none;
        }
    }
    
    #date-filter select, #date-filter button, #date-filter a {
        border-radius:0rem;
    }

    table td:first-child {
        text-align: left
    }

    #owners-equity, #profit-dist > div.col-sm-6:nth-child(even) {
        padding-right: 0.25rem;
    }
    #financial-statement, #profit-dist > div.col-sm-6:nth-child(odd) {
        padding-left: 0.25rem;
    }
</style>
{% endblock style %}
{% load extra_tags %}
{% load bootstrap4 %}
{% block main %}

<div class="d-print-none">
    <form method="get" class="d-flex" id="date-filter">
        <div class="py-2 mr-2">হিসাবের মাস</div>
        <div>{% bootstrap_field date_form.month layout='horizontal' show_label=False field_class="col-12" %}</div>
        <div>{% bootstrap_field date_form.year layout='horizontal' show_label=False field_class="col-12" %}</div>
        <div>
            <button type="submit" class='btn' id='go-btn'>
                <i class='bi bi-arrow-right-square-fill text-success'></i>
            </button>
            <a href="{% url 'incomestatement' month=prev.month year=prev.year %}" class="btn btn-info"><i class="bi bi-chevron-left"></i></a>
            <a href="{% url 'incomestatement' month=next.month year=next.year %}" class="btn btn-info"><i class="bi bi-chevron-right"></i></a>
        </div>
        <div class="p-2 ml-3">
            <input type="checkbox" id="profit-dist-check" checked>
            <label for="profit-dist-check">মুনাফা বন্টন</label>
        </div>
    </form>
</div>

<div class="text-center" id="header">
    <h3 class='d-none d-print-block'>প্রধান সি এন জি এন্ড ফিলিং স্টেশন</h3>
    <h3>মাসিক আয়-ব্যয় বিবরণী</h3>
    <h4>{{month|e2b_month}},{{year|e2b_digit}}</h4>
    {% if not status %}
    <div class='text-danger'>({{last_bal_date|e2b_date}} তারিখ পর্যন্ত)</div>
    {% endif %}
</div>

<div class="row" id="incomestatement">
    <div class="col-sm-6 pr-1">
        <table class="table table-bordered table-striped table-sm text-right">
            <tr class="text-center">
                <th>আয়সমূহ</th>
                <th>টাকা</th>
                <th>টাকা</th>
            </tr>
            <tr>
                <td colspan='2'>নিট বিক্রয়</td>
                <td>{{sell_amount|e2b_digit|ezynumber}}</td>
            </tr>
            <tr>
                <td colspan='2'>বাদঃ বিক্রিত পন্যের ব্যয়ঃ</td>
                <td rowspan='4' class='align-bottom'>({{product_sell_expense|e2b_digit|ezynumber}})</td>
            </tr>
            <tr>
                <td class='pl-4'>প্রারম্ভিক মজুদ পণ্য</td>
                <td>{{initial_storage_amount|e2b_digit|ezynumber}}</td>
            </tr>
            <tr>
                <td class='pl-4'>ক্রয়</td>
                <td>{{purchase_amount|e2b_digit|ezynumber}}</td>
            </tr>
            <tr>
                <td class='pl-4'>বাদঃ সমাপনী মজুদ পণ্য</td>
                <td>({{ending_storage_amount|e2b_digit|ezynumber}})</td>
            </tr>
            <tr class='text-right'>
                <th colspan='2'>মোট মুনাফাঃ</th>
                <th>{{total_profit|e2b_digit|ezynumber}}</th>
            </tr>
            <tr>
                <th colspan='2'>অন্যান্য আয়ঃ</th>
                <td rowspan="{{revenues.count|add:1}}" class='align-bottom'>
                    {{revenue_amount|e2b_digit|ezynumber}}
                </td>
            </tr>
            {% for revenue in revenues %}
            <tr>
                <td>{{revenue.group__name}}</td>
                <td>{{revenue.rev_amount|e2b_digit|ezynumber}}</td>
            </tr>
            {% endfor %}
            <tr class='text-right'>
                <th colspan='2'>মোট আয়ঃ</th>
                <th>{{total_income|e2b_digit|ezynumber}}</th>
            </tr>
        </table>
    </div>
    <div class="col-sm-6 pl-1">
        <table class="table table-bordered table-striped table-sm text-right">
            <tr class="text-center">
                <th>ব্যয়সমূহ</th>
                <th>টাকা</th>
            </tr>
            {% for expenditure in expenditures %}
            <tr>
                <td>{{expenditure.group__name}}</td>
                <td>{{expenditure.exp_amount|e2b_digit|ezynumber}}</td>
            </tr>
            {% endfor %}
            {% if baddebt %}
            <tr>
                <td>অনাদায়ী পাওনা</td>
                <td>{{baddebt|e2b_digit|ezynumber}}</td>
            </tr>
            {% endif %}
            <tr class='text-right'>
                <th>মোট খরচঃ</th>
                <td rowspan="{{expenditures.count|add:1}}" class='align-bottom'>
                    {{expenditure_amount|e2b_digit|ezynumber}}
                </td>
            </tr>
        </table>
    </div>
    <div class="col-12 mb-3">
        <h4>নিট লাভঃ {{net_profit|e2b_digit|ezynumber}}/=</h4>
    </div>
</div>

<div class="row">
    <div class="col-sm-6" id="owners-equity">
        <h3 class="text-center">মালিকানা স্বত্ব বিবরণী</h3>
        <table class="table table-bordered table-striped table-sm text-right">
            <tr class="text-center">
                <th>মালিকানা স্বত্ব</th>
                <th>টাকা</th>
                <th>টাকা</th>
            </tr>
            <tr>
                <td>প্রারম্ভিক মূলধন</td>
                <td></td>
                <td>{{capital|e2b_digit|ezynumber}}</td>
            </tr>
            {% if investment_amount %}
            <tr>
                <td>অতিরিক্ত মূলধন</td>
                <td></td>
                <td>{{investment_amount|e2b_digit|ezynumber}}</td>
            </tr>
            {% endif %}
            <tr>
                <td>নীট মূনাফা</td>
                <td>{{net_profit|e2b_digit|ezynumber}}</td>
                <td></td>
            </tr>
            <tr>
                <td class="pl-3">বাদঃ উত্তোলন</td>
                <td>({{withdraws|e2b_digit|ezynumber}})</td>
                <td>{{rem_profit|e2b_digit|ezynumber}}</td>
            </tr>
            {% if diff %}
            <tr>
                <td colspan="3">&nbsp;</td>
            </tr>
            {% endif %}
            {% if fixed_assets %}
            <tr>
                <td colspan="3">&nbsp;</td>
            </tr>
            {% endif %}
            <tr>
                <th>{% if total_asset == total_oe %}<i class="bi bi-check-all text-success"></i>{% endif %} মোটঃ</th>
                <th></th>
                <th>{{total_oe|e2b_digit|ezynumber}}</th>
            </tr>
        </table>
    </div>
    <div class="col-sm-6" id="financial-statement">
        <h3 class="text-center">আর্থিক অবস্থার বিবরণী</h3>
        <table class="table table-bordered table-striped table-sm text-right">
            <tr class="text-center">
                <th>সম্পদ সমূহ</th>
                <th>টাকা</th>
            </tr>
            <tr>
                <td>হাতে নগদ/ব্যাংক উদ্বৃত্ত</td>
                <td>{{cash|e2b_digit|ezynumber}}</td>
            </tr>
            <tr>
                <td>দেনাদার/পার্টি ব্যালেন্স</td>
                <td>{{dues|e2b_digit|ezynumber}}</td>
            </tr>
            <tr>
                <td>সমাপনী মজুদ পণ্য</td>
                <td>{{ending_storage_amount|e2b_digit|ezynumber}}</td>
            </tr>
            {% if fixed_assets %}
            <tr>
                <td>স্থায়ী সম্পত্তি</td>
                <td>{{fixed_assets|e2b_digit|ezynumber}}</td>
            </tr>
            {% endif %}
            {% if diff %}
            <tr>
                <td>ব্যবধান</td>
                <td>{{diff|e2b_digit|ezynumber}}</td>
            </tr>
            {% endif %}
            <tr>
                <th>{% if total_asset == total_oe %}<i class="bi bi-check-all text-success"></i>{% endif %} মোটঃ</th>
                <th>{{total_asset|e2b_digit|ezynumber}}</th>
            </tr>
        </table>
    </div>
</div>

{% if profit_distribution %}
<div class="row" id="profit-dist">
    <div class="col-12">
        <h3 class="text-center">মুনাফা বন্টন</h3>
    </div>

    {% for op in profit_distribution %}
    <div class="col-sm-6">
        <table class="table table-bordered table-striped table-sm text-right">
            <tr class="text-center">
                <th>{{op.owner.name}}</th>
                <th>টাকা</th>
                <th>টাকা</th>
            </tr>
            <tr>
                <td>প্রারম্ভিক মূলধন</td>
                <td></td>
                <td>{{op.prev_oe|e2b_digit|ezynumber}}</td>
            </tr>
            {% if investment in op %}
            <tr>
                <td>অতিরিক্ত মূলধন</td>
                <td></td>
                <td>{{op.investment|e2b_digit|ezynumber}}</td>
            </tr>
            {% endif %}
            <tr>
                <td>মূনাফা (নীট লাভের {{op.prev_share|floatformat:-2|e2b_digit}}%)</td>
                <td>{{op.profit|e2b_digit|ezynumber}}</td>
                <td></td>
            </tr>
            <tr>
                <td class="pl-3">বাদঃ উত্তোলন</td>
                <td>({{op.withdraw|e2b_digit|ezynumber}})</td>
                <td>{{op.rem_profit|e2b_digit|ezynumber}}</td>
            </tr>
            <tr>
                <th>মোটঃ</th>
                <th></th>
                <th>{{op.current_oe|e2b_digit|ezynumber}}</th>
            </tr>
        </table>
    </div>
    {% endfor %}
</div>
{% endif %}

<script>
    $("#profit-dist-check").on('click', function(){
        $("#profit-dist").toggle('fast');
    });
</script>
{% endblock main %}